# This is a simple Serverless Workflow that will be
# translated into a Temporal workflow
document:
  dsl: 1.0.0
  namespace: zigflow # Mapped to the task queue
  name: example # Workflow name
  version: 0.0.1
  title: Example Workflow
  summary: An example of how to use Serverless Workflow to define Temporal Workflows
timeout:
  after:
    minutes: 1
do:
  - set:
      export:
        as: ${ . }
      set:
        report_id: some-report-id
  - pollReportStatus:
      output:
        as: '${ $context + { pollResults: . } }'
      for:
        in: ${ 5 }
      while: ${ $data.pollReportStatus.report_status.reportStatus != "report.status.available" }
      do:
        - checkStatus:
            call: http
            with:
              method: get
              endpoint: ${ "http://localhost:9998/" + $context.report_id + "/status" }
            export:
              as: '${ $context + { report_status: . } }'
        - waitBetweenPolls:
            output:
              as: ${ $context }
            wait:
              seconds: 1
